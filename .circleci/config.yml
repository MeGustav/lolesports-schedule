version: 2
jobs:
  build:
    docker:
      - image: circleci/java:8-jdk
    working_directory: ~/repo
    environment:
      MAVEN_OPTS: -Xmx3200m
    steps:
      - checkout
      - run: mvn clean install
      - deploy:
          name: Copy dist
          command: scp -oStrictHostKeyChecking=no ~/repo/dist/target/distributive.zip $SERVER_USER@$SERVER_IP:$DIST_PATH/distributive.zip
      - run:
          name: Unpack
          command: ssh -oStrictHostKeyChecking=no $SERVER_USER@$SERVER_IP "python3 $DEPLOY_SCRIPTS_PATH/deploy.py $DIST_PATH/distributive.zip $APP_PATH $BOT_NAME $BOT_TOKEN"